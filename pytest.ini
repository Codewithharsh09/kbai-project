[pytest]
# Pytest Configuration for KBAI Backend
# Client Testing Policy: 70% coverage + automated testing via GitHub Actions

# Test discovery patterns
python_files = test_*.py
python_classes = Test*
python_functions = test_*

# Test paths
testpaths = tests

# Add project root to Python path
pythonpath = .

# Minimum coverage requirement (70% as per client policy)
# Note: Install pytest-cov for coverage: pip install pytest-cov
addopts = 
    -v
    --strict-markers
    --tb=short
    --maxfail=1
    -p no:warnings
    
# Coverage options (uncomment when pytest-cov is installed)
# --cov=src
# --cov-report=html:htmlcov
# --cov-report=term-missing
# --cov-report=xml
# --cov-fail-under=70

# Custom markers for test organization
markers =
    unit: Unit tests (small, fast, isolated)
    integration: Integration tests (multiple components)
    security: Security-focused tests
    performance: Performance tests
    slow: Tests that take more than 1 second
    auth: Authentication/authorization tests
    otp: OTP and 2FA tests
    password_reset: Password reset flow tests
    smoke: Smoke tests (critical path)

# Coverage options
[coverage:run]
source = src
omit = 
    */tests/*
    */migrations/*
    */venv/*
    */__pycache__/*
    */site-packages/*

[coverage:report]
precision = 2
show_missing = True
skip_covered = False
exclude_lines =
    pragma: no cover
    def __repr__
    raise AssertionError
    raise NotImplementedError
    if __name__ == .__main__.:
    if TYPE_CHECKING:
    @abstractmethod

[coverage:html]
directory = htmlcov

# Logging
log_cli = true
log_cli_level = INFO
log_cli_format = %(asctime)s [%(levelname)8s] %(message)s
log_cli_date_format = %Y-%m-%d %H:%M:%S

# Performance options
timeout = 300
timeout_method = thread

# Parallel execution for better performance
addopts = 
    -v
    --strict-markers
    --tb=short
    --maxfail=1
    -p no:warnings
    -n auto  # Enable parallel execution

